<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.9">
    <title>OmniTool</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #5a2a2a;
            display: flex;
        }

        /* Hamburger Icon Styles */
        .hamburger-menu {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            width: 30px;
            height: 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            z-index: 10; /* Ensure it's above other elements */
            transition: opacity 0.3s;
        }

        .hamburger-menu .bar {
            width: 100%;
            height: 3px;
            background-color: white;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 220px;
            background-color: #3c1f1f;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            min-height: 100vh;
            transition: transform 0.3s cubic-bezier(.4,1.2,.6,1); /* Smoother animation */
            position: absolute;
            top: 0;
            left: 0;
            z-index: 5;
            box-shadow: 2px 0 8px rgba(0,0,0,0.18); /* Slight shadow for depth */
        }

        .sidebar.minimized {
            transform: translateX(-220px);
        }

        /* Overlay for sidebar */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.3);
            z-index: 4;
            transition: opacity 0.3s;
        }
        .sidebar-overlay.active {
            display: block;
        }

        .tab-list {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 50px;
        }

        .tab-item {
            appearance: none;
            background: none;
            border: none;
            outline: none;
            color: #fff;
            font-size: 16px;
            font-weight: 500;
            padding: 15px 10px;
            text-align: left;
            cursor: pointer;
            border-radius: 0;
            background: linear-gradient(to bottom right, #EF4765, #FF9A5A);
            opacity: 0.8;
            transition:
                background 0.2s,
                opacity 0.2s,
                box-shadow 0.2s,
                transform 0.15s;
            margin: 0;
            border-bottom: 1px solid #3c1f1f;
            user-select: none;
        }
        .tab-item:last-child {
            border-bottom: none;
        }

        .tab-item.active,
        .tab-item:focus {
            opacity: 1;
            background: linear-gradient(to bottom right, #FF9A5A, #EF4765);
            box-shadow: 0 2px 10px rgba(239, 71, 101, 0.15);
            color: #fff;
            font-weight: 700;
            transform: scale(1.04);
        }
        .tab-item:hover {
            opacity: 1;
            background: linear-gradient(to bottom right, #FF9A5A, #EF4765);
            transform: scale(1.03);
        }

        /* Rearranging visual effect */
        .tab-item.dragging {
            opacity: 0.5;
            background: #888 !important;
        }
        .tab-item.drag-over {
            border-top: 2px solid #FF9A5A;
        }

        /* Make tab-list scrollable if too many items */
        .tab-list {
            overflow-y: auto;
            max-height: 90vh;
        }

        /* Content area */
        .content {
            flex: 1;
            color: white;
            height: 100%;
            margin-left: 220px;
            transition: margin-left 0.3s cubic-bezier(.4,1.2,.6,1);
        }

        .content.minimized {
            margin-left: 0;
        }

        iframe {
            width: 100%;
            height: calc(100% - 0px);
            border: none;
            display: block;
            transform: scale(1.0);
            transform-origin: top left;
        }

        /* Responsive design for mobile */
        @media (max-width: 700px) {
            .sidebar {
                width: 70vw;
                min-width: 180px;
                max-width: 320px;
            }
            .sidebar.minimized {
                transform: translateX(-75vw);
            }
            .content {
                margin-left: 0 !important;
            }
            .content.minimized {
                margin-left: 0 !important;
            }
        }
    </style>
</head>
<body>

    <button class="hamburger-menu" id="hamburgerBtn" aria-label="Open sidebar" aria-expanded="false">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
    </button>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="sidebar minimized" id="sidebar" aria-label="Sidebar Navigation">
        <div class="tab-list" id="tabList">
            <button class="tab-item active" id="tab-ts101" data-page="TS_101.html" tabindex="0" draggable="true">TROUBLESHOOTING</button>
            <button class="tab-item" id="tab-templates" data-page="TEMPLATES.html" tabindex="0" draggable="true">TEMPLATES</button>
            <button class="tab-item" id="tab-probingq" data-page="Probing_Questions.html" tabindex="0" draggable="true">PROBING</button>
            <button class="tab-item" id="tab-snooze" data-page="Snooze.html" tabindex="0" draggable="true">SNOOZE</button>
            <button class="tab-item" id="tab-case" data-page="Case_Template.html" tabindex="0" draggable="true">CASE TEMPLATES</button>
            <button class="tab-item" id="tab-links" data-page="Links.html" tabindex="0" draggable="true">LINKS</button>
            <button class="tab-item" id="tab-pdf" data-page="pdf.html" tabindex="0" draggable="true">PDF Maker</button>
            <button class="tab-item" id="tab-probing11" data-page="Probing11.html" tabindex="0" draggable="true">PROBING</button>
            <button class="tab-item" id="tab-copy1" data-page="copy1template.html" tabindex="0" draggable="true">CopyTemplate</button>
            <button class="tab-item" id="tab-follow5" data-page="follow5.html" tabindex="0" draggable="true">C-Tracker</button>
            <button class="tab-item" id="tab-emailzz" data-page="EMAILZZ.html" tabindex="0" draggable="true">EmailTemplate</button>
            <button class="tab-item" id="tab-txt" data-page="TXT.html" tabindex="0" draggable="true">TXT file</button>
            <button class="tab-item" id="tab-processguide" data-page="Omnichannel PC Process Guide.html" tabindex="0" draggable="true">Process Guide file</button>
            <button class="tab-item" id="tab-processguide" data-page="process_builder.html" tabindex="0" draggable="true">Process_Builder</button>
        </div>
    </div>

    <div class="content minimized" id="content">
        <iframe id="contentFrame" src="TS_101.html"></iframe>
    </div>

    <script>
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const content = document.getElementById('content');
        const tabList = document.getElementById('tabList');
        let tabButtons = tabList.querySelectorAll('.tab-item');
        const iframe = document.getElementById('contentFrame');

        // ---- Persistent Tab Order ----
        function saveTabOrder() {
            const order = Array.from(tabList.children).map(tab => tab.id);
            localStorage.setItem('tabOrder', JSON.stringify(order));
        }

        function loadTabOrder() {
            const order = JSON.parse(localStorage.getItem('tabOrder') || '[]');
            if (order.length) {
                // Map id -> element
                const tabMap = {};
                Array.from(tabList.children).forEach(tab => { tabMap[tab.id] = tab; });
                // Remove all tabs
                while (tabList.firstChild) tabList.removeChild(tabList.firstChild);
                // Re-add in order
                order.forEach(id => {
                    if (tabMap[id]) tabList.appendChild(tabMap[id]);
                });
                // Add any tabs not in storage (e.g. new ones added to HTML)
                Object.values(tabMap).forEach(tab => {
                    if (!tabList.contains(tab)) tabList.appendChild(tab);
                });
            }
        }

        // Initial state: sidebar hidden, hamburger visible, content minimized
        function setSidebarMinimized(minimized) {
            if (minimized) {
                sidebar.classList.add('minimized');
                content.classList.add('minimized');
                sidebarOverlay.classList.remove('active');
                hamburgerBtn.setAttribute('aria-expanded', 'false');
            } else {
                sidebar.classList.remove('minimized');
                content.classList.remove('minimized');
                sidebarOverlay.classList.add('active');
                hamburgerBtn.setAttribute('aria-expanded', 'true');
            }
        }

        // Hamburger click toggles sidebar/menu
        hamburgerBtn.addEventListener('click', () => {
            setSidebarMinimized(sidebar.classList.contains('minimized') ? false : true);
        });

        // Overlay click closes sidebar
        sidebarOverlay.addEventListener('click', () => {
            setSidebarMinimized(true);
        });

        // Space bar toggles sidebar/menu
        document.addEventListener('keydown', function(e) {
            // If focus is on input or textarea, ignore
            const tag = document.activeElement.tagName.toLowerCase();
            if ((tag === 'input' || tag === 'textarea')) return;

            if (e.code === 'Space' || e.key === ' ') {
                e.preventDefault();
                setSidebarMinimized(sidebar.classList.contains('minimized') ? false : true);
            }
            // Esc closes sidebar for accessibility
            if (e.code === 'Escape' || e.key === 'Escape') {
                setSidebarMinimized(true);
            }
            // Keyboard navigation for tabs (left/right or up/down arrows)
            if ((e.code === 'ArrowDown' || e.code === 'ArrowUp') && sidebar && !sidebar.classList.contains('minimized')) {
                let tabs = Array.from(tabButtons);
                let idx = tabs.indexOf(document.activeElement);
                if (idx !== -1) {
                    if (e.code === 'ArrowDown') {
                        tabs[(idx+1)%tabs.length].focus();
                    } else {
                        tabs[(idx-1+tabs.length)%tabs.length].focus();
                    }
                    e.preventDefault();
                }
            }
        });

        // Click on a tab: sidebar is hidden, hamburger is still visible
        function setTabClickHandlers() {
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active from all
                    tabButtons.forEach(b => b.classList.remove('active'));
                    // Add active to clicked
                    this.classList.add('active');
                    // Load page
                    iframe.src = this.getAttribute('data-page');
                    // Hide sidebar but keep hamburger visible
                    setSidebarMinimized(true);
                    // Save selected tab to localStorage
                    localStorage.setItem('lastActiveTab', this.id);
                });
            });
        }

        // --- Rearranging Tabs Feature ---

        let draggedTab = null;

        function handleDragStart(e) {
            draggedTab = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            try { e.dataTransfer.setData('text/plain', ''); } catch (err) {}
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            if (!this.classList.contains('drag-over')) {
                this.classList.add('drag-over');
            }
        }

        function handleDragEnter(e) {
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            if (draggedTab && draggedTab !== this) {
                const tabListElem = this.parentNode;
                const tabsArr = Array.from(tabListElem.children);
                let insertBefore = true;
                if (tabsArr.indexOf(draggedTab) < tabsArr.indexOf(this)) {
                    insertBefore = false;
                }
                if (insertBefore) {
                    tabListElem.insertBefore(draggedTab, this);
                } else {
                    tabListElem.insertBefore(draggedTab, this.nextSibling);
                }
                tabsArr.forEach(t => t.classList.remove('drag-over'));
                tabButtons = tabList.querySelectorAll('.tab-item');
                setTabClickHandlers();
                setTabDragHandlers();
                saveTabOrder();
            }
            this.classList.remove('drag-over');
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            tabButtons.forEach(tab => tab.classList.remove('drag-over'));
        }

        function setTabDragHandlers() {
            tabButtons.forEach(btn => {
                btn.setAttribute('draggable', 'true');
                btn.removeEventListener('dragstart', handleDragStart);
                btn.removeEventListener('dragover', handleDragOver);
                btn.removeEventListener('dragenter', handleDragEnter);
                btn.removeEventListener('dragleave', handleDragLeave);
                btn.removeEventListener('drop', handleDrop);
                btn.removeEventListener('dragend', handleDragEnd);

                btn.addEventListener('dragstart', handleDragStart);
                btn.addEventListener('dragover', handleDragOver);
                btn.addEventListener('dragenter', handleDragEnter);
                btn.addEventListener('dragleave', handleDragLeave);
                btn.addEventListener('drop', handleDrop);
                btn.addEventListener('dragend', handleDragEnd);
            });
        }

        // On page load, restore tab order, active tab, and set up handlers
        window.addEventListener('DOMContentLoaded', () => {
            loadTabOrder();
            tabButtons = tabList.querySelectorAll('.tab-item');
            setTabClickHandlers();
            setTabDragHandlers();
            setSidebarMinimized(true);

            // Restore the last active tab, if any
            const lastActiveTabId = localStorage.getItem('lastActiveTab');
            let foundActive = false;
            if (lastActiveTabId) {
                tabButtons.forEach(btn => {
                    if (btn.id === lastActiveTabId) {
                        btn.classList.add('active');
                        iframe.src = btn.getAttribute('data-page');
                        foundActive = true;
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
            // If none found, make sure the first tab is active
            if (!foundActive && tabButtons.length > 0) {
                tabButtons.forEach((btn,i) => btn.classList.toggle('active', i===0));
                iframe.src = tabButtons[0]?.getAttribute('data-page');
            }
        });

    </script>

</body>

</html>
